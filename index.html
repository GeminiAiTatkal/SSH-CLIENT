<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>SSH Terminal - ADVPS</title>
    <meta name="description" content="SSH Terminal- An ADVPS service"/>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xterm@5.3.0/lib/xterm.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/xterm@5.3.0/css/xterm.css">
</head>
<body class="__variable_1e4310 __variable_c3aa02 antialiased">
    <div class="min-h-screen w-screen flex flex-col items-center justify-center bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 relative overflow-hidden p-4 sm:p-6 md:p-8">
        <div class="rounded-xl border text-card-foreground shadow bg-gray-800 bg-opacity-50 backdrop-blur-md backdrop-filter border-gray-700 w-full max-w-lg">
            <div class="flex flex-col space-y-1.5 p-6">
                <a class="flex flex-row items-center justify-between gap-4 mb-4" href="https://advps.store">
                    <div class="h-16 w-16 bg-gradient-to-br from-orange-400 to-rose-400 rounded-lg flex items-center justify-center text-white font-bold text-xl">A</div>
                    <h1 class="font-bold flex flex-col">
                        <span class="text-sm text-gray-200">Powered By</span>
                        <span class="text-2xl bg-gradient-to-br from-orange-400 to-rose-400 bg-clip-text text-transparent">ADVPS</span>
                    </h1>
                </a>
                <div class="flex items-center justify-between">
                    <h3 class="tracking-tight font-bold text-2xl text-white">Enter Linux Credentials</h3>
                </div>
            </div>
            <div class="p-6 pt-0">
                <textarea id="credentials" class="flex min-h-[60px] w-full rounded-md border px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 bg-gray-800 border-gray-700 text-gray-200 placeholder:text-gray-400 focus:ring-purple-500 focus:border-purple-500" placeholder="Enter: IP:USERNAME:PASSWORD" rows="3"></textarea>
            </div>
            <div class="flex items-center p-6 pt-0">
                <button onclick="connectSSH()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">Connect SSH</button>
            </div>
        </div>

        <div id="terminal-container" class="hidden mt-8 w-full max-w-6xl bg-black rounded-lg border border-gray-700 shadow-2xl">
            <div class="bg-gray-800 px-4 py-2 rounded-t-lg flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                    <span class="ml-4 text-gray-300 text-sm" id="terminal-title">SSH Terminal</span>
                </div>
                <button onclick="disconnect()" class="text-red-400 hover:text-red-300 text-sm">Disconnect</button>
            </div>
            <div id="terminal" class="h-96 bg-black rounded-b-lg"></div>
        </div>
    </div>

    <script>
        let terminal;
        let isConnected = false;

        function connectSSH() {
            const credentials = document.getElementById('credentials').value.trim();
            if (!credentials) {
                alert('Enter credentials');
                return;
            }

            const parts = credentials.split(':');
            if (parts.length !== 3) {
                alert('Format: IP:USERNAME:PASSWORD');
                return;
            }

            const [host, username, password] = parts;
            
            document.getElementById('terminal-container').classList.remove('hidden');
            document.getElementById('terminal-title').textContent = `SSH - ${username}@${host}`;

            terminal = new Terminal({
                cursorBlink: true,
                theme: {
                    background: '#000000',
                    foreground: '#00ff00',
                    cursor: '#00ff00'
                },
                fontSize: 14,
                fontFamily: 'Monaco, Menlo, "Ubuntu Mono", monospace'
            });

            terminal.open(document.getElementById('terminal'));
            terminal.write('Connecting to ' + host + '...\r\n');
            
            // Test SSH connection via Vercel API
            fetch('/api/ssh', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ host, username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    terminal.write('Real SSH connection established!\r\n');
                    terminal.write('Welcome to Ubuntu 20.04.6 LTS\r\n');
                    terminal.write('Last login: ' + new Date().toLocaleString() + '\r\n');
                    terminal.write('\r\n');
                    
                    isConnected = true;
                    const symbol = username === 'root' ? '#' : '$';
                    terminal.write(`${username}@server:~${symbol} `);
                    
                    setupRealTerminal(host, username, password);
                } else {
                    terminal.write('SSH Error: ' + data.error + '\r\n');
                }
            })
            .catch(error => {
                terminal.write('Connection failed: ' + error.message + '\r\n');
            });
        }
        
        function setupRealTerminal(host, username, password) {
            let currentCommand = '';
            
            terminal.onData(data => {
                if (data === '\r') {
                    terminal.write('\r\n');
                    if (currentCommand.trim()) {
                        executeRealCommand(currentCommand.trim(), host, username, password);
                    } else {
                        const symbol = username === 'root' ? '#' : '$';
                        terminal.write(`${username}@server:~${symbol} `);
                    }
                    currentCommand = '';
                } else if (data === '\u007f') {
                    if (currentCommand.length > 0) {
                        currentCommand = currentCommand.slice(0, -1);
                        terminal.write('\b \b');
                    }
                } else {
                    currentCommand += data;
                    terminal.write(data);
                }
            });
        }
        
        function executeRealCommand(command, host, username, password) {
            const symbol = username === 'root' ? '#' : '$';
            const promptText = `${username}@server:~${symbol} `;
            
            if (command === 'clear') {
                terminal.clear();
                terminal.write(promptText);
                return;
            }
            
            if (command === 'exit') {
                terminal.write('logout\r\n');
                disconnect();
                return;
            }
            
            // Execute real SSH command
            fetch('/api/ssh', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ host, username, password, command })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.output) {
                    terminal.write(data.output.replace(/\n/g, '\r\n'));
                } else {
                    terminal.write('Command failed\r\n');
                }
                terminal.write(promptText);
            })
            .catch(() => {
                terminal.write('Command execution failed\r\n');
                terminal.write(promptText);
            });
        }



        }
        
        function disconnect() {
            document.getElementById('terminal-container').classList.add('hidden');
            isConnected = false;
        }
    </script>
</body>
</html>